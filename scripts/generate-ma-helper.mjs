import fs from 'fs';

const rawData = JSON.parse(fs.readFileSync('ma_legislators_data.json', 'utf-8'));
const data = {};
Object.keys(rawData).forEach(key => {
    data[key] = {
        name: key,
        ...rawData[key]
    };
});

const fileContent = `
// This file is auto-generated by scripts/generate-ma-helper.mjs
// This file is auto-generated by scripts/generate-ma-helper.mjs
// Do not edit manually. Last updated: ${new Date().toISOString()}

export interface LegislatorContact {
    name: string;
    email: string;
    phone: string;
    role: 'Senator' | 'Representative';
}

const LEGISLATOR_DATA: Record<string, LegislatorContact> = ${JSON.stringify(data, null, 4)};

export const getMALegislatorContact = (nameInput: string, roleInput: string = 'Representative'): LegislatorContact => {
    // 1. Try Direct Match
    // Clean input name: remove "Rep.", "Sen." etc.
    const cleanName = nameInput.replace(/^(Rep\.|Sen\.|Senator|Representative)\s+/i, '').trim();
    
    // exact match
    if (LEGISLATOR_DATA[cleanName]) {
        return LEGISLATOR_DATA[cleanName];
    }
    
    // 2. Try Fuzzy Match (First Last)
    // If input is "Michael J. Barrett" and key is "Michael Barrett"
    // Or input is "Mike Barrett" and key is "Michael Barrett" (harder)
    
    // Let's try to match Last Name and First Letter at least?
    // This handles "Michael J. Barrett" -> "Michael Barrett"
    const parts = cleanName.split(' ');
    const last = parts[parts.length - 1];
    const first = parts[0];
    
    const candidates = Object.values(LEGISLATOR_DATA).filter(p => {
        const pParts = p.name.split(' ');
        const pLast = pParts[pParts.length - 1];
        const pFirst = pParts[0];
        return pLast.toLowerCase() === last.toLowerCase() && pFirst[0].toLowerCase() === first[0].toLowerCase();
    });
    
    if (candidates.length === 1) {
        return candidates[0];
    }
    
    // 3. Last Resort Fallback (Algorithmic)
    // If truly not found (newly elected?), fallback to the old logic or a generic one.
    // Given we scraped the full list, this should be rare.
    
    const role = roleInput.toLowerCase().includes('senat') ? 'Senator' : 'Representative';
    const domain = role === 'Senator' ? 'masenate.gov' : 'mahouse.gov';
    
    return {
        name: cleanName,
        email: \`\${first}.\${last}@\${domain}\`,
        phone: '(617) 722-2000', // Default switchboard
        role
    };
};
`;

fs.writeFileSync('lib/ma-legislators.ts', fileContent);
console.log('Generated lib/ma-legislators.ts');
