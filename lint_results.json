[{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\[state]\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\[state]\\person\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\[state]\\transparency\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\[state]\\wizard\\WizardForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\[state]\\wizard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\page.tsx:22:13\n  20 |         if (saved) {\n  21 |             // eslint-disable-next-line\n> 22 |             setFavorites(JSON.parse(saved));\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  23 |         }\n  24 |         setMounted(true);\n  25 |     }, []);","line":22,"column":13,"nodeType":null,"endLine":22,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\app\\transparency\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\AccessibilityMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\AccessibilityProvider.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\AccessibilityProvider.tsx:31:25\n  29 |\n  30 |         // eslint-disable-next-line\n> 31 |         if (storedSize) setFontSize(storedSize);\n     |                         ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  32 |         if (storedDyslexia) setDyslexiaFont(storedDyslexia);\n  33 |         if (storedMotion) setReduceMotion(storedMotion);\n  34 |         setMounted(true);","line":31,"column":25,"nodeType":null,"endLine":31,"endColumn":36,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\CalendarWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\Dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\SmartPill.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\ThemeProvider.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\ThemeProvider.tsx:35:13\n  33 |         const saved = localStorage.getItem(storageKey) as Theme;\n  34 |         if (saved) {\n> 35 |             setTheme(saved);\n     |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  36 |         }\n  37 |     }, [storageKey]);\n  38 |","line":35,"column":13,"nodeType":null,"endLine":35,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\n\r\ntype Theme = \"dark\" | \"light\" | \"system\";\r\n\r\ntype ThemeProviderProps = {\r\n    children: React.ReactNode;\r\n    defaultTheme?: Theme;\r\n    storageKey?: string;\r\n};\r\n\r\ntype ThemeProviderState = {\r\n    theme: Theme;\r\n    setTheme: (theme: Theme) => void;\r\n};\r\n\r\nconst initialState: ThemeProviderState = {\r\n    theme: \"system\",\r\n    setTheme: () => null,\r\n};\r\n\r\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\r\n\r\nexport function ThemeProvider({\r\n    children,\r\n    defaultTheme = \"system\",\r\n    storageKey = \"civic-ui-theme\",\r\n}: ThemeProviderProps) {\r\n    const [theme, setTheme] = useState<Theme>(defaultTheme);\r\n    // Load from storage AND handle system listener\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem(storageKey) as Theme;\r\n        if (saved) {\r\n            setTheme(saved);\r\n        }\r\n    }, [storageKey]);\r\n\r\n    useEffect(() => {\r\n        // Logic to actually apply classes\r\n        const root = window.document.documentElement;\r\n        root.classList.remove(\"light\", \"dark\");\r\n\r\n        if (theme === \"system\") {\r\n            const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\r\n                .matches\r\n                ? \"dark\"\r\n                : \"light\";\r\n            root.classList.add(systemTheme);\r\n        } else {\r\n            root.classList.add(theme);\r\n        }\r\n    }, [theme]);\r\n\r\n    const value = {\r\n        theme,\r\n        setTheme: (theme: Theme) => {\r\n            localStorage.setItem(storageKey, theme);\r\n            setTheme(theme);\r\n        },\r\n    };\r\n\r\n    return (\r\n        <ThemeProviderContext.Provider value={value}>\r\n            {children}\r\n        </ThemeProviderContext.Provider>\r\n    );\r\n}\r\n\r\nexport const useTheme = () => {\r\n    const context = useContext(ThemeProviderContext);\r\n\r\n    if (context === undefined)\r\n        throw new Error(\"useTheme must be used within a ThemeProvider\");\r\n\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\ThemeToggle.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\components\\ThemeToggle.tsx:11:9\n   9 |\n  10 |     useEffect(() => {\n> 11 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  12 |     }, []);\n  13 |\n  14 |     const toggleTheme = () => {","line":11,"column":9,"nodeType":null,"endLine":11,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useTheme } from \"./ThemeProvider\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nexport function ThemeToggle() {\r\n    const { theme, setTheme } = useTheme();\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    const toggleTheme = () => {\r\n        if (theme === 'system') {\r\n            const isSystemDark = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n            setTheme(isSystemDark ? \"light\" : \"dark\");\r\n        } else {\r\n            setTheme(theme === \"dark\" ? \"light\" : \"dark\");\r\n        }\r\n    };\r\n\r\n    if (!mounted) return null; // Avoid hydration mismatch\r\n\r\n    return (\r\n        <button\r\n            onClick={toggleTheme}\r\n            className=\"p-2 rounded-full bg-gray-100 dark:bg-card-border hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors\"\r\n            aria-label=\"Toggle Dark Mode\"\r\n        >\r\n            {(theme === \"dark\" || (theme === \"system\" && typeof window !== 'undefined' && window.matchMedia(\"(prefers-color-scheme: dark)\").matches)) ? (\r\n                // Sun Icon\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-yellow-500\">\r\n                    <circle cx=\"12\" cy=\"12\" r=\"5\"></circle>\r\n                    <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\"></line>\r\n                    <line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\"></line>\r\n                    <line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\"></line>\r\n                    <line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\"></line>\r\n                    <line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\"></line>\r\n                    <line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\"></line>\r\n                    <line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\"></line>\r\n                    <line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\"></line>\r\n                </svg>\r\n            ) : (\r\n                // Moon Icon\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-gray-700\">\r\n                    <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"></path>\r\n                </svg>\r\n            )}\r\n        </button>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\hooks\\useSavedBills.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\hooks\\useSavedBills.ts:25:21\n  23 |                 if (Array.isArray(parsed) && parsed.length > 0 && typeof parsed[0] === 'number') {\n  24 |                     console.warn('Detected old schema (IDs only). Resetting storage to support State Metadata.');\n> 25 |                     setSavedBills([]);\n     |                     ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |                     localStorage.removeItem(STORAGE_KEY);\n  27 |                 } else {\n  28 |                     setSavedBills(parsed);","line":25,"column":21,"nodeType":null,"endLine":25,"endColumn":34}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\n\r\nconst STORAGE_KEY = 'civic_saved_bills';\r\n\r\nexport interface SavedBill {\r\n    id: number;\r\n    state: string;\r\n}\r\n\r\nexport function useSavedBills() {\r\n    const [savedBills, setSavedBills] = useState<SavedBill[]>([]);\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem(STORAGE_KEY);\r\n        if (saved) {\r\n            try {\r\n                const parsed = JSON.parse(saved);\r\n                // Schema Migration: If it's an array of numbers (old schema), wipe it effectively (or migrate if we could guess, but we can't).\r\n                // Safest for MVP is to check if the first item is a number.\r\n                if (Array.isArray(parsed) && parsed.length > 0 && typeof parsed[0] === 'number') {\r\n                    console.warn('Detected old schema (IDs only). Resetting storage to support State Metadata.');\r\n                    setSavedBills([]);\r\n                    localStorage.removeItem(STORAGE_KEY);\r\n                } else {\r\n                    setSavedBills(parsed);\r\n                }\r\n            } catch (e) {\r\n                console.error('Failed to parse saved bills', e);\r\n            }\r\n        }\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    const toggleSave = (billId: number, stateCode: string) => {\r\n        const exists = savedBills.some(b => b.id === billId);\r\n        let newBills;\r\n\r\n        if (exists) {\r\n            newBills = savedBills.filter(b => b.id !== billId);\r\n        } else {\r\n            newBills = [...savedBills, { id: billId, state: stateCode }];\r\n        }\r\n\r\n        setSavedBills(newBills);\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(newBills));\r\n    };\r\n\r\n    const isSaved = (billId: number) => savedBills.some(b => b.id === billId);\r\n\r\n    // Helper to get raw IDs for legacy compatibility / filtering\r\n    const savedIds = savedBills.map(b => b.id);\r\n\r\n    return { savedBills, savedIds, toggleSave, isSaved, mounted };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\cache-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\committees.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\enrichment.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\legiscan.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":230,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":230,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":352,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":352,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":386,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":386,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":400,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":400,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":426,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":426,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":443,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":443,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Bill, Hearing, AmendedBill, Pill } from '@/types';\r\nimport { enrichment } from './enrichment';\r\n\r\nconst BASE_URL = 'https://api.legiscan.com/';\r\n\r\n// Mock Data for MVP\r\n// Mock Data Factory\r\nconst getMockHearings = (state: string): Hearing[] => {\r\n    if (state.toUpperCase() === 'NJ') {\r\n        return [{\r\n            hearing_id: 2,\r\n            date: '2026-02-04',\r\n            time: '1:00 PM',\r\n            location: 'Committee Room 4, 1st Floor',\r\n            description: 'Senate Budget and Appropriations Meeting',\r\n            committee: 'Budget and Appropriations',\r\n            bill_number: 'S123',\r\n            bill_id: 2001,\r\n            bill_url: 'https://legiscan.com/NJ/bill/S123/2024',\r\n            type: 'Senate',\r\n            ai_summary: 'Proposed legislation to provide extended property tax relief for veterans living in continuing care retirement communities.',\r\n            sponsor_info: {\r\n                name: 'Sen. Kristin M. Corrado',\r\n                id: 'senator-corrado',\r\n                party: 'R',\r\n                next_election: '2027',\r\n                major_donors: []\r\n            },\r\n            smart_pills: [\r\n                { label: 'Veterans', category: 'people', icon: 'üéñÔ∏è' },\r\n                { label: 'Tax Relief', category: 'impact', icon: 'üí∞' }\r\n            ]\r\n        }];\r\n    }\r\n\r\n    // Default (NH/MA)\r\n    return [{\r\n        hearing_id: 1,\r\n        date: '2026-02-03', // Next Tuesday\r\n        time: '10:00 AM',\r\n        location: 'LOB 301',\r\n        description: 'Public Hearing on Zoning Modifications',\r\n        committee: 'Municipal and County Government',\r\n        bill_number: 'HB 1234',\r\n        bill_id: 1001,\r\n        bill_url: 'https://legiscan.com/NH/bill/HB1234/2024',\r\n        type: 'House',\r\n        ai_summary: 'This bill proposes changes to local zoning laws to allow for more \"Accessory Dwelling Units\" (granny flats) by right, aiming to increase affordable housing stock without major infrastructure changes.',\r\n        sponsor_info: {\r\n            name: 'Rep. Joe Smith',\r\n            id: 'rep-joe-smith',\r\n            party: 'R',\r\n            next_election: '2026',\r\n            major_donors: [\r\n                { name: \"AIPAC\", amount: 5000, category: 'PAC' },\r\n                { name: \"NH Association of Realtors\", amount: 500, category: 'Industry' }\r\n            ]\r\n        },\r\n        smart_pills: [\r\n            { label: 'This Week', category: 'urgency', icon: '‚è∞', description: 'Hearing is happening within 7 days' },\r\n            { label: 'Affects Renters', category: 'people', icon: 'üè†' },\r\n            { label: 'Municipal Cost', category: 'impact', icon: 'üí∞', description: 'May increase costs for town budgets' },\r\n            { label: 'Local Control', category: 'impact', icon: 'üèòÔ∏è', description: 'Impacts ability of towns to set own zoning' }\r\n        ]\r\n    }];\r\n};\r\n\r\nimport { cachedData } from './cache-utils';\r\n\r\n// Helper to normalize LegiScan's weird \"Object with numeric keys\" arrays\r\n// e.g. { \"0\": {...}, \"1\": {...} } -> [{...}, {...}]\r\nconst normalizeArray = (info: Record<string, unknown> | unknown[] | null | undefined): unknown[] => {\r\n    if (!info) return [];\r\n    if (Array.isArray(info)) return info;\r\n    // Filter out non-numeric keys like \"summary\" or \"mime_type\" which sometimes appear mixed in\r\n    return Object.keys(info)\r\n        .filter(k => !isNaN(parseInt(k)))\r\n        .map(k => (info as Record<string, unknown>)[k]);\r\n};\r\n\r\n// Helper to get the correct session ID for the current year\r\nexport const getActiveSessionId = async (state: string): Promise<{ id: number, year: number } | null> => {\r\n    try {\r\n        const API_KEY = process.env.LEGISCAN_API_KEY; // Ensure API KEY is available\r\n        const res = await fetch(`${BASE_URL}?key=${API_KEY}&op=getSessionList&state=${state}`);\r\n        const data = await res.json();\r\n\r\n        if (data.status === 'ERROR' || !data.sessions) {\r\n            console.warn(`LegiScan Session Error for ${state}:`, data.alert?.message);\r\n            return null;\r\n        }\r\n\r\n        // Find session covering today\r\n        // Prefer \"Regular Session\" if multiple are active\r\n        const currentYear = new Date().getFullYear();\r\n\r\n        // Filter for sessions in current or last year\r\n        const relevantSessions = data.sessions.filter((s: { year_start: number }) =>\r\n            s.year_start >= currentYear - 1\r\n        );\r\n\r\n        // Sort by Year Descending\r\n        relevantSessions.sort((a: { year_start: number }, b: { year_start: number }) => b.year_start - a.year_start);\r\n\r\n        // 1. Try to find the latest session that actually has data (dataset_hash is not null)\r\n        const activeWithData = relevantSessions.find((s: { dataset_hash: string }) => s.dataset_hash);\r\n\r\n        if (activeWithData) {\r\n            if (process.env.DEBUG) console.log(`State ${state}: Using most recent populated session: ${activeWithData.year_start} (ID: ${activeWithData.session_id})`);\r\n            return { id: activeWithData.session_id, year: activeWithData.year_start };\r\n        }\r\n\r\n        // 2. Fallback: If no data hash (e.g. very new session), just take the newest one\r\n        // and hope for the best, or maybe the previous year?\r\n        // Let's take the newest one but warn.\r\n        // Actually, for the demo, we prefer data. If 2026 is empty, show 2025.\r\n        // The above check `activeWithData` handles this! It skips 2026 (null hash) and picks 2025.\r\n\r\n        if (relevantSessions.length > 0) {\r\n            if (process.env.DEBUG) console.log(`State ${state}: No populated session found? Defaulting to newest: ${relevantSessions[0].year_start}`);\r\n            return { id: relevantSessions[0].session_id, year: relevantSessions[0].year_start };\r\n        }\r\n\r\n        const fallback = data.sessions[0];\r\n        return fallback ? { id: fallback.session_id, year: fallback.year_start } : null;\r\n\r\n    } catch (e) {\r\n        console.error(`Failed to get session list for ${state}`, e);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport const legiscan = {\r\n    // New Combined Fetch with Caching\r\n    getDashboardData: async (state: string = 'NH'): Promise<{ hearings: Hearing[], amendments: AmendedBill[] }> => {\r\n        return cachedData(\r\n            async () => {\r\n                const API_KEY = process.env.LEGISCAN_API_KEY; // Re-read env inside cache context if needed\r\n                if (!API_KEY) {\r\n                    console.warn('‚ö†Ô∏è No LegiScan API Key found. Returning mock hearings only.');\r\n                    return { hearings: getMockHearings(state), amendments: [] };\r\n                }\r\n\r\n                try {\r\n                    // 1. Get Session ID Explicitly\r\n                    const sessionInfo = await getActiveSessionId(state);\r\n                    if (!sessionInfo) {\r\n                        console.error(`‚ùå Could not find active session for ${state}`);\r\n                        return { hearings: getMockHearings(state), amendments: [] };\r\n                    }\r\n                    const { id: sessionId, year: sessionYear } = sessionInfo;\r\n                    const isHistorical = sessionYear < new Date().getFullYear();\r\n\r\n                    if (process.env.DEBUG) console.log(`üì° Fetching Master List for ${state} (Session ${sessionId}, Historical: ${isHistorical})...`);\r\n                    const masterListRes = await fetch(`${BASE_URL}?key=${API_KEY}&op=getMasterList&id=${sessionId}`);\r\n                    const masterData = await masterListRes.json();\r\n\r\n                    if (masterData.status === 'ERROR') { // Handle Limit/Errors at MasterList level\r\n                        if (masterData.alert?.message?.includes('exceeded')) {\r\n                            console.warn('‚ö†Ô∏è API Limit Exceeded (Global)');\r\n                            throw new Error('API_LIMIT');\r\n                        }\r\n                        console.error('LegiScan Error:', masterData.alert?.message);\r\n                        return { hearings: getMockHearings(state), amendments: [] };\r\n                    }\r\n\r\n                    // 2. Sort bills by most recently active\r\n                    // REDUCED LIMIT: Only scan top 40 actively moving bills to save API calls (The \"Miser\" Strategy)\r\n                    const bills = (Object.values(masterData.masterlist || {}) as { bill_id: number; last_action_date: string }[])\r\n                        .sort((a, b) => new Date(b.last_action_date).getTime() - new Date(a.last_action_date).getTime())\r\n                        .slice(0, 40);\r\n\r\n                    if (process.env.DEBUG) console.log(`üîç Scanning top ${bills.length} bills for hearings & amendments...`);\r\n\r\n                    const realHearings: Hearing[] = [];\r\n                    const recentAmendments: AmendedBill[] = [];\r\n                    const today = new Date();\r\n                    today.setHours(0, 0, 0, 0);\r\n\r\n                    const parseDate = (dateStr: string) => {\r\n                        const [y, m, d] = dateStr.split('-').map(Number);\r\n                        return new Date(y, m - 1, d, 12, 0, 0);\r\n                    };\r\n\r\n                    // Parallel wrapper\r\n                    await Promise.all(bills.map(async (billMeta: { bill_id: number }) => {\r\n                        if (!billMeta.bill_id) return;\r\n\r\n                        try {\r\n                            const detailRes = await fetch(`${BASE_URL}?key=${API_KEY}&op=getBill&id=${billMeta.bill_id}`);\r\n                            const detailData = await detailRes.json();\r\n\r\n                            // Check for API Limit Error in Individual Response\r\n                            if (detailData.alert && detailData.alert.message && detailData.alert.message.includes('exceeded')) {\r\n                                console.warn('‚ö†Ô∏è API Limit hit during detail fetch');\r\n                                throw new Error('API_LIMIT');\r\n                            }\r\n\r\n                            const bill = detailData.bill;\r\n                            if (!bill) return;\r\n\r\n                            // ... Enrichment Logic ...\r\n                            // Enrichment Logic (with Committee Fallback)\r\n                            const sponsorName = (bill.sponsors && bill.sponsors[0]) ? bill.sponsors[0].name : (bill.committee ? `Joint Committee on ${bill.committee.name}` : 'Unknown');\r\n                            const apiSponsor = bill.sponsors && bill.sponsors[0];\r\n                            const enriched = enrichment.getPersonDetails(sponsorName);\r\n\r\n                            const sponsorInfo = {\r\n                                name: sponsorName,\r\n                                id: apiSponsor?.people_id ? String(apiSponsor.people_id) : (bill.committee ? 'committee' : enriched.id),\r\n                                party: (apiSponsor ? apiSponsor.party : 'N/A') as 'R' | 'D' | 'I' | 'N/A',\r\n                                role: (bill.committee && !apiSponsor) ? 'Committee' : (apiSponsor?.role || 'Representative'),\r\n                                next_election: enriched.next_election || '2026',\r\n                                major_donors: enriched.major_donors || []\r\n                            };\r\n\r\n                            // A) Check for Hearings\r\n                            if (bill.calendar && bill.calendar.length > 0) {\r\n                                bill.calendar.forEach((event: { date: string, time: string, event_id: number, location: string, description: string }) => {\r\n                                    const hearingDate = parseDate(event.date);\r\n                                    // Relax filter for historical sessions\r\n                                    if (hearingDate >= today || isHistorical) {\r\n                                        let formattedTime = event.time;\r\n                                        try {\r\n                                            const [h, m] = event.time.split(':');\r\n                                            const hour = parseInt(h);\r\n                                            const ampm = hour >= 12 ? 'PM' : 'AM';\r\n                                            const hour12 = hour % 12 || 12;\r\n                                            formattedTime = `${hour12}:${m} ${ampm}`;\r\n                                        } catch (_e) { }\r\n\r\n                                        realHearings.push({\r\n                                            hearing_id: event.event_id || Math.random(),\r\n                                            date: event.date,\r\n                                            time: formattedTime,\r\n                                            location: event.location || 'State House',\r\n                                            description: event.description || bill.title,\r\n                                            committee: bill.committee ? bill.committee.name : 'Unknown Committee',\r\n                                            bill_number: bill.bill_number,\r\n                                            bill_id: bill.bill_id,\r\n                                            bill_url: bill.url,\r\n                                            type: bill.body_short === 'H' ? 'House' : 'Senate',\r\n                                            ai_summary: bill.summary ? (bill.summary.length > 140 ? bill.summary.substring(0, 140) + '...' : bill.summary) : (bill.description || ''),\r\n                                            sponsor_info: sponsorInfo,\r\n                                            smart_pills: [\r\n                                                ...enrichment.generateSmartPills(bill.title),\r\n                                                ...(enrichment.calculateStalledStatus(bill.last_action_date, bill.status)\r\n                                                    ? [{ label: 'Stalled', category: 'urgency', icon: 'üï∏Ô∏è', description: `No action since ${bill.last_action_date}` }]\r\n                                                    : []),\r\n                                                ...(enrichment.calculateBipartisanship(bill.sponsors?.map((s: { party: string }) => s.party) || [])\r\n                                                    ? [{ label: 'Bipartisan', category: 'politics', icon: 'ü§ù', description: 'Supported by both parties' }]\r\n                                                    : [])\r\n                                            ] as Pill[]\r\n                                        });\r\n                                    }\r\n                                });\r\n                            }\r\n\r\n                            // B) Check for Recent Amendments\r\n                            if (bill.history && Array.isArray(bill.history)) {\r\n                                const recentAmendmentEvent = bill.history.find((event: { date: string, action: string }) => {\r\n                                    const evtDate = parseDate(event.date);\r\n                                    const isRecent = (today.getTime() - evtDate.getTime()) / (1000 * 3600 * 24) < 90;\r\n                                    const actionLower = event.action.toLowerCase();\r\n                                    const isAmendment = actionLower.includes('amend') || actionLower.includes('report') || actionLower.includes('otpa') || actionLower.includes('adopted') || actionLower.includes('concur');\r\n                                    // Allow if recent OR historical session\r\n                                    return (isRecent || isHistorical) && isAmendment;\r\n                                });\r\n\r\n                                const sponsorName = (bill.sponsors && bill.sponsors[0]) ? bill.sponsors[0].name : (bill.committee ? `Joint Committee on ${bill.committee.name}` : 'Unknown');\r\n                                const apiSponsor = bill.sponsors && bill.sponsors[0];\r\n                                const enriched = enrichment.getPersonDetails(sponsorName);\r\n\r\n                                const sponsorInfo = {\r\n                                    name: sponsorName,\r\n                                    id: apiSponsor?.people_id ? String(apiSponsor.people_id) : (bill.committee ? 'committee' : enriched.id),\r\n                                    party: (apiSponsor ? apiSponsor.party : 'N/A') as 'R' | 'D' | 'I' | 'N/A',\r\n                                    role: (bill.committee && !apiSponsor) ? 'Committee' : (apiSponsor?.role || 'Representative'),\r\n                                    next_election: enriched.next_election || '2026',\r\n                                    major_donors: enriched.major_donors || []\r\n                                };\r\n\r\n                                if (recentAmendmentEvent) {\r\n                                    recentAmendments.push({\r\n                                        bill_id: bill.bill_id,\r\n                                        bill_number: bill.bill_number,\r\n                                        description: bill.title,\r\n                                        amendment_date: recentAmendmentEvent.date,\r\n                                        amendment_action: recentAmendmentEvent.action,\r\n                                        sponsor_info: sponsorInfo,\r\n                                        link: bill.url,\r\n                                        smart_pills: [\r\n                                            ...enrichment.generateSmartPills(bill.title),\r\n                                            ...(enrichment.calculateBipartisanship(bill.sponsors?.map((s: { party: string }) => s.party) || [])\r\n                                                ? [{ label: 'Bipartisan', category: 'politics', icon: 'ü§ù', description: 'Supported by both parties' }]\r\n                                                : [])\r\n                                        ] as Pill[]\r\n                                    });\r\n                                }\r\n                            }\r\n\r\n                        } catch (err: unknown) {\r\n                            if ((err as Error).message === 'API_LIMIT') throw err; // Re-throw to stop fetching\r\n                        }\r\n                    }));\r\n\r\n                    realHearings.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n                    recentAmendments.sort((a, b) => new Date(b.amendment_date).getTime() - new Date(a.amendment_date).getTime());\r\n\r\n                    // FALLBACK: If \"Ghost Town\" (No hearings, No amendments), show *something*\r\n                    // Just take the top 5 most recently active bills and treat them as \"Recent Activity\"\r\n                    if (realHearings.length === 0 && recentAmendments.length === 0) {\r\n                        console.log(`State ${state}: No hearings or amendments found. Activating 'Recent Activity' fallback.`);\r\n\r\n                        const recentActivity = await Promise.all(bills.slice(0, 5).map(async (billMeta: { bill_id: number }) => {\r\n                            if (!billMeta.bill_id) return null;\r\n                            try {\r\n                                const detailRes = await fetch(`${BASE_URL}?key=${API_KEY}&op=getBill&id=${billMeta.bill_id}`);\r\n                                const detailData = await detailRes.json();\r\n                                const bill = detailData.bill;\r\n                                if (!bill) return null;\r\n\r\n                                const sponsorName = (bill.sponsors && bill.sponsors[0]) ? bill.sponsors[0].name : (bill.committee ? `Joint Committee on ${bill.committee.name}` : 'Unknown');\r\n                                const apiSponsor = bill.sponsors && bill.sponsors[0];\r\n                                const enriched = enrichment.getPersonDetails(sponsorName);\r\n\r\n                                const sponsorInfo = {\r\n                                    name: sponsorName,\r\n                                    id: apiSponsor?.people_id ? String(apiSponsor.people_id) : (bill.committee ? 'committee' : enriched.id),\r\n                                    party: (apiSponsor ? apiSponsor.party : 'N/A') as 'R' | 'D' | 'I' | 'N/A',\r\n                                    role: (bill.committee && !apiSponsor) ? 'Committee' : (apiSponsor?.role || 'Representative'),\r\n                                    next_election: enriched.next_election || '2026',\r\n                                    major_donors: enriched.major_donors || []\r\n                                };\r\n\r\n                                // Create a \"Generic Activity\" entry\r\n                                // We map it to AmendedBill type for UI compatibility, \r\n                                // but label the action clearly.\r\n                                return {\r\n                                    bill_id: bill.bill_id,\r\n                                    bill_number: bill.bill_number,\r\n                                    description: bill.title,\r\n                                    amendment_date: bill.last_action_date,\r\n                                    amendment_action: bill.last_action || 'Updated',\r\n                                    sponsor_info: sponsorInfo,\r\n                                    link: bill.url,\r\n                                    smart_pills: [\r\n                                        ...enrichment.generateSmartPills(bill.title),\r\n                                        { label: 'Recent Update', category: 'urgency', icon: '‚ö°', description: 'Recently active' }\r\n                                    ] as Pill[]\r\n                                };\r\n                            } catch (_e) { return null; }\r\n                        }));\r\n\r\n                        const validFallback = recentActivity.filter(Boolean) as AmendedBill[];\r\n                        recentAmendments.push(...validFallback);\r\n                    }\r\n\r\n                    return { hearings: realHearings, amendments: recentAmendments };\r\n\r\n                } catch (e) {\r\n                    console.error('LegiScan Global Error:', e);\r\n                    // Fallback to MOCK if everything explodes\r\n                    return { hearings: getMockHearings(state), amendments: [] };\r\n                }\r\n            },\r\n            ['dashboard-data-v2', state], // Cache Key\r\n            3600 // Revalidate every 1 hour\r\n        );\r\n    },\r\n\r\n    // Legacy / Convenience\r\n    getUpcomingHearings: async (state: string = 'NH'): Promise<Hearing[]> => {\r\n        const data = await legiscan.getDashboardData(state);\r\n        return data.hearings;\r\n    },\r\n\r\n    getBillDetails: async (billId: number): Promise<Bill | null> => {\r\n        return cachedData(async () => {\r\n            const API_KEY = process.env.LEGISCAN_API_KEY;\r\n            if (!API_KEY) return null;\r\n            try {\r\n                const res = await fetch(`${BASE_URL}?key=${API_KEY}&op=getBill&id=${billId}`);\r\n                const data = await res.json();\r\n                return data.bill as Bill;\r\n            } catch (_e) {\r\n                return null;\r\n            }\r\n        }, [`bill-details-${billId}`], 86400); // Cache individual bills for 24 hours\r\n    },\r\n\r\n    getRollCall: async (rollCallId: number): Promise<unknown | null> => {\r\n        return cachedData(async () => {\r\n            const API_KEY = process.env.LEGISCAN_API_KEY;\r\n            if (!API_KEY) return null;\r\n            try {\r\n                const res = await fetch(`${BASE_URL}?key=${API_KEY}&op=getRollCall&id=${rollCallId}`);\r\n                const data = await res.json();\r\n                return data.roll_call;\r\n            } catch (_e) {\r\n                return null;\r\n            }\r\n        }, [`roll-call-${rollCallId}`], 86400 * 7); // Cache roll calls heavily\r\n    },\r\n\r\n    getPerson: async (peopleId: string): Promise<Record<string, unknown> | null> => {\r\n        return cachedData(async () => {\r\n            const API_KEY = process.env.LEGISCAN_API_KEY;\r\n            if (!API_KEY) return null;\r\n            try {\r\n                const res = await fetch(`${BASE_URL}?key=${API_KEY}&op=getPerson&id=${peopleId}`);\r\n                const data = await res.json();\r\n\r\n                console.log(`‚úÖ getPerson(${peopleId}) - Status: ${data.status}`);\r\n\r\n                // Enrich with committees if available\r\n                if (data.person && data.person.committee_list) {\r\n                    const committees = normalizeArray(data.person.committee_list);\r\n                    data.person.committees = committees.map((c) => (c as { name: string }).name);\r\n                    console.log(`   ‚îú‚îÄ Committees: ${committees.length} found`);\r\n                } else {\r\n                    console.log(`   ‚îú‚îÄ Committees: NONE (raw value: ${typeof data.person?.committee_list})`);\r\n                }\r\n\r\n                return data.person;\r\n            } catch (_e) {\r\n                return null;\r\n            }\r\n        }, [`person-v2-${peopleId}`], 86400 * 30); // Cache person details for 30 days (rarely changes)\r\n    },\r\n\r\n    // Generic Search\r\n    searchBills: async (state: string, query: string): Promise<unknown[]> => {\r\n        return cachedData(async () => {\r\n            const API_KEY = process.env.LEGISCAN_API_KEY;\r\n            if (!API_KEY) return [];\r\n            try {\r\n                const res = await fetch(`${BASE_URL}?key=${API_KEY}&op=getSearch&state=${state}&query=${encodeURIComponent(query)}`);\r\n                const data = await res.json();\r\n                if (data.status === 'ERROR' || !data.searchresult) return [];\r\n\r\n                return normalizeArray(data.searchresult);\r\n            } catch (_e) {\r\n                return [];\r\n            }\r\n        }, [`search-${state}-${query}`], 3600); // Cache search for 1 hour\r\n    },\r\n\r\n    getSponsoredList: async (peopleId: string, sessionId?: number, stateCode: string = 'NH'): Promise<Record<string, unknown>[] | null> => {\r\n        return cachedData(async () => {\r\n            const API_KEY = process.env.LEGISCAN_API_KEY;\r\n            if (!API_KEY) return null;\r\n            try {\r\n                // 1. Try Standard Lookup\r\n                let url = `${BASE_URL}?key=${API_KEY}&op=getSponsoredList&id=${peopleId}`;\r\n                if (sessionId) {\r\n                    url += `&session_id=${sessionId}`;\r\n                }\r\n                console.log(`üì° fetching sponsored list: ${url}`);\r\n\r\n                const res = await fetch(url);\r\n                const data = await res.json();\r\n\r\n                let bills: Record<string, unknown>[] = [];\r\n                if (data.sponsoredbills) {\r\n                    bills = normalizeArray(data.sponsoredbills) as Record<string, unknown>[];\r\n                }\r\n\r\n                // 2. FALLBACK: If list is empty, try Name Search (Fix for broken API links)\r\n                if (bills.length === 0) {\r\n                    console.log(`‚ö†Ô∏è No direct sponsorships found for ${peopleId}. Attempting Search Fallback...`);\r\n\r\n                    // A) Get Person Name\r\n                    const person = await legiscan.getPerson(peopleId);\r\n                    if (person && person.name) {\r\n                        const nameQuery = String(person.name); // e.g. \"David Walker\"\r\n                        console.log(`   üîé Searching for bills matching: \"${nameQuery}\" in ${stateCode}`);\r\n\r\n                        // B) Search Bills using properly passed state code\r\n                        const searchResults = await legiscan.searchBills(stateCode, nameQuery);\r\n\r\n                        // C) Verify Sponsorship by fetching details (Limit to top 10 to save API)\r\n                        // This is expensive, so we only do it if absolutely necessary\r\n                        const potentialBills = searchResults.slice(0, 10);\r\n\r\n                        console.log(`   üîé Found ${potentialBills.length} potential matches. Verifying...`);\r\n\r\n                        const verifiedBills = [];\r\n                        for (const pb of potentialBills) {\r\n                            const b = pb as { bill_id: number; bill_number: string; title: string; last_action: string; last_action_date: string; text_url?: string; url?: string };\r\n                            if (!b.bill_id) continue;\r\n                            const details = await legiscan.getBillDetails(b.bill_id);\r\n                            if (details && details.sponsors) {\r\n                                // Check if OUR guy is in the sponsor list\r\n                                const isSponsor = details.sponsors.some((s: { people_id: unknown }) => String(s.people_id) === String(peopleId));\r\n                                if (isSponsor) {\r\n                                    // Map to the \"SponsoredList\" format (which is lighter than full bill)\r\n                                    verifiedBills.push({\r\n                                        bill_id: b.bill_id,\r\n                                        bill_number: b.bill_number,\r\n                                        title: b.title,\r\n                                        description: b.title, // Search results put title in title\r\n                                        last_action: b.last_action,\r\n                                        last_action_date: b.last_action_date,\r\n                                        url: b.text_url || b.url\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                        console.log(`   ‚úÖ Verified ${verifiedBills.length} bills via fallback.`);\r\n                        bills = verifiedBills;\r\n                    }\r\n                }\r\n\r\n                console.log(`   ‚îú‚îÄ Bills: ${bills.length} found`);\r\n\r\n                // Sort by Bill ID Descending (Proxy for newest)\r\n                return (bills as { bill_id: number }[]).sort((a, b) => {\r\n                    return (b.bill_id - a.bill_id);\r\n                });\r\n\r\n            } catch (e) {\r\n                console.error(\"SponsoredList Error\", e);\r\n                return null;\r\n            }\r\n        }, [`sponsored-list-v3-${peopleId}`], 86400 * 7); // Cache for 7 days\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\legislator-contact.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1473,1476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1473,1476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2107,2110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2107,2110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getMALegislatorContact } from './ma-legislators';\r\nimport { enrichment } from './enrichment';\r\nimport REGISTRY from './data/legislator-registry.json';\r\n\r\nexport interface LegislatorContact {\r\n    name: string;\r\n    id?: string;\r\n    email: string;\r\n    phone: string;\r\n    role: 'Senator' | 'Representative' | 'Committee';\r\n    district?: string;\r\n    party?: string;\r\n}\r\n\r\n/**\r\n * Returns contact info for a legislator based on state and name.\r\n * Uses specific scrapers/helpers where available (MA), otherwise generic fallbacks.\r\n */\r\nexport const getLegislatorContact = (state: string, name: string, roleInput: string = 'Representative'): LegislatorContact => {\r\n    const stateCode = state.toUpperCase();\r\n\r\n    // 1. STATE-SPECIFIC STRATEGIES (The \"Unique Ways\")\r\n    // Massachusetts (Scraped Data Strategy)\r\n    if (stateCode === 'MA') {\r\n        const maContact = getMALegislatorContact(name, roleInput);\r\n        // Try to enrich ID even for MA\r\n        const enriched = enrichment.getPersonDetails(name);\r\n        return { ...maContact, id: enriched.id };\r\n    }\r\n\r\n    // 2. UNIVERSAL FALLBACK STRATEGY (The \"Redundancy Layer\")\r\n\r\n    // Source A: Local Enrichment (Mock Database) - Primary\r\n    const enriched = enrichment.getPersonDetails(name);\r\n\r\n    // Source B: Static Registry (JSON File) - Secondary Redundancy\r\n    // Now scoped by state to avoid collisions (e.g. REGISTRY['NH']['Smith'])\r\n    const stateRegistry = (REGISTRY as Record<string, any>)[stateCode];\r\n    const registryData = stateRegistry ? stateRegistry[name] : undefined;\r\n\r\n    // Merge Logic: Prefer Primary, Fallback to Secondary\r\n    const email = enriched.email || registryData?.email || \"\";\r\n    const phone = enriched.phone || registryData?.phone || \"\";\r\n\r\n    // ID Logic: Use enriched ID if available, else generate slug from registry match\r\n    const finalId = enriched.id || (registryData ? name.toLowerCase().replace(/\\s+/g, '-') : undefined);\r\n\r\n    return {\r\n        name: name,\r\n        id: finalId,\r\n        email: email,\r\n        phone: phone,\r\n        role: (roleInput || registryData?.role) as any,\r\n        district: enriched.district || registryData?.district,\r\n        party: enriched.party || registryData?.party\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\legislators.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\ma-legislators.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\mail-providers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\lib\\states.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\next.config.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3,"endColumn":48}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextConfig } from \"next\";\r\n\r\nconst withPWA = require(\"@ducanh2912/next-pwa\").default({\r\n  dest: \"public\",\r\n  disable: process.env.NODE_ENV === \"development\",\r\n  register: true,\r\n  scope: \"/\",\r\n  sw: \"service-worker.js\",\r\n});\r\n\r\nconst nextConfig: NextConfig = {\r\n  compress: true, // Enable Gzip compression (default, but explicit for clarity)\r\n  poweredByHeader: false, // Save bytes, improve security\r\n  eslint: {\r\n    ignoreDuringBuilds: true,\r\n  },\r\n  typescript: {\r\n    ignoreBuildErrors: true,\r\n  },\r\n};\r\n\r\nexport default withPWA(nextConfig);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\LLM_KNOWLEDGE\\Legislate\\nh-civic-app\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]